<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorgu Paneli</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        :root {
            --bg-color: #000000;
            --primary: #00ffff;
            --secondary: #00bfff;
            --text: #e0e0e0;
            --panel-bg: rgba(10, 10, 10, 0.8);
            --border: #008080;
            --error: #ff4500;
            --success: #32cd32;
            --panel-glow: rgba(0, 255, 255, 0.3);
            --sidebar-bg: rgba(5, 5, 5, 0.9);
            --sidebar-border: #008080;
            --result-card-bg: #1a1a1a; /* Yeni eklenen sonuç kartı arka plan rengi */
            --result-card-border: #004d4d; /* Yeni eklenen sonuç kartı kenarlık rengi */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto Mono', monospace;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            animation: background-glow 10s infinite alternate;
        }

        @keyframes background-glow {
            from { box-shadow: 0 0 200px rgba(0, 255, 255, 0.05) inset; }
            to { box-shadow: 0 0 200px rgba(0, 255, 255, 0.15) inset; }
        }

        .header {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin: 20px 0;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary);
            letter-spacing: 3px;
            animation: header-pulse 5s infinite;
            text-align: center;
            width: 100%;
        }

        @keyframes header-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.03); opacity: 0.95; }
        }

        .main-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
        }

        .menu-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 101;
            cursor: pointer;
            width: 40px;
            height: 40px;
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid var(--border);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s;
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
        }

        .menu-toggle span {
            display: block;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            margin: 2px 0;
            box-shadow: 0 0 8px var(--primary);
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--sidebar-border);
            backdrop-filter: blur(15px);
            z-index: 100;
            transform: translateX(-100%);
            transition: transform 0.4s ease-in-out;
            padding: 80px 20px 20px 20px;
            overflow-y: auto;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.5);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px var(--panel-glow);
            animation: panel-fade-in 0.8s ease-out;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 30px var(--panel-glow);
        }

        @keyframes panel-fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel-title {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--secondary);
            font-size: 0.9rem;
        }

        select, input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            background: #111;
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--text);
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
        }
        
        button {
            background: var(--primary);
            color: var(--bg-color);
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 10px var(--primary);
        }

        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.5s, opacity 0.5s;
        }

        button:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 191, 255, 0.3);
        }
        
        button:hover::after {
            transform: translate(-50%, -50%) scale(100);
            opacity: 1;
        }

        button:disabled {
            background: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        button.success {
            background-color: var(--success);
            box-shadow: 0 5px 15px rgba(50, 205, 50, 0.3);
        }

        button.error {
            background-color: var(--error);
            box-shadow: 0 5px 15px rgba(255, 69, 0, 0.3);
        }

        .result {
            background: #111;
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 15px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
            line-height: 1.5;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .result strong {
            color: var(--secondary);
        }

        .result p {
            margin-bottom: 5px;
        }

        .result .highlight {
            color: var(--primary);
            font-weight: bold;
        }

        .result-card {
            background-color: var(--result-card-bg);
            border: 1px solid var(--result-card-border);
            border-radius: 5px;
            padding: 10px;
            animation: card-fade-in 0.5s ease-out;
            transition: box-shadow 0.3s;
        }

        .result-card:hover {
            box-shadow: 0 0 15px var(--panel-glow);
        }

        @keyframes card-fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .actions button {
            flex: 1;
            padding: 8px;
            font-size: 0.8rem;
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
            box-shadow: none;
        }

        .actions button:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .loader {
            border: 3px solid rgba(0, 255, 255, 0.2);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 18px;
            background: var(--panel-bg);
            border-radius: 5px;
            transform: translateX(200%);
            transition: transform 0.4s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { border: 1px solid var(--success); }
        .notification.error { border: 1px solid var(--error); }

        .notification-icon {
            font-size: 1.5rem;
        }

        #inputs > div {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        #inputs.show > div {
            opacity: 1;
            transform: translateY(0);
        }

        .input-field {
            animation: input-fade-in 0.6s ease-out;
        }

        @keyframes input-fade-in {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sidebar-title {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--sidebar-border);
            padding-bottom: 5px;
        }

        .sorgu-category {
            margin-bottom: 15px;
        }

        .category-header {
            color: var(--secondary);
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 8px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .category-header:hover {
            color: var(--primary);
        }

        .sorgu-list {
            list-style: none;
            padding-left: 10px;
        }

        .sorgu-list li {
            padding: 5px 0;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .sorgu-list li::before {
            content: '>';
            color: var(--primary);
            margin-right: 5px;
            transition: margin-right 0.2s;
        }
        
        .sorgu-list li:hover {
            color: var(--secondary);
            transform: translateX(5px);
        }

        .sorgu-list li.active {
            color: var(--primary);
            font-weight: bold;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease-in-out;
        }

        .overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
    </style>
</head>
<body>
    <div class="menu-toggle" id="menu-toggle">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-title">Sorgu Menüsü</div>

        <label for="api">API Seçin:</label>
        <select id="api">
            <option value="1">API 1</option>
            <option value="2">API 2</option>
        </select>
        
        <div class="sorgu-category">
            <div class="category-header">Kimlik Sorguları</div>
            <ul class="sorgu-list">
                <li data-sorgu="1">1 - Sülale Sorgu</li>
                <li data-sorgu="2">2 - TC Bilgi</li>
                <li data-sorgu="3">3 - Adres Sorgu</li>
                <li data-sorgu="4">4 - Ad+Soyad+İl</li>
                <li data-sorgu="5">5 - Aile Sorgu</li>
                <li data-sorgu="8">8 - Diploma Sorgu</li>
                <li data-sorgu="12">12 - CM Bilgisi</li>
                <li data-sorgu="13">13 - Çocuk Bilgisi</li>
                <li data-sorgu="14">14 - Anne Bilgisi</li>
                <li data-sorgu="15">15 - Ehliyet Sorgu</li>
                <li data-sorgu="19">19 - Hikaye Sorgu</li>
                <li data-sorgu="20">20 - Vesika Sorgu</li>
                <li data-sorgu="21">21 - Hane Sorgu</li>
                <li data-sorgu="22">22 - Muhattap Sorgu</li>
                <li data-sorgu="26">26 - Sertifika Sorgu</li>
                <li data-sorgu="27">27 - Üniversite Sorgu</li>
                <li data-sorgu="31">31 - Personel Sorgu</li>
                <li data-sorgu="33">33 - NVI Sorgu</li>
                <li data-sorgu="35">35 - Başvuru Sorgu</li>
                <li data-sorgu="36">36 - Polis Kaydı</li>
                <li data-sorgu="37">37 - Tapu Sorgu</li>
                <li data-sorgu="38">38 - Okul No Sorgu</li>
                <li data-sorgu="39">39 - İşyeri Yetkili</li>
                <li data-sorgu="40">40 - İşyeri Sorgu</li>
                <li data-sorgu="41">41 - İNFO Sorgu (1+2+3+5)</li>
            </ul>
        </div>
        
        <div class="sorgu-category">
            <div class="category-header">Telefon / İletişim Sorguları</div>
            <ul class="sorgu-list">
                <li data-sorgu="6">6 - Numaradan TC</li>
                <li data-sorgu="7">7 - TC'den Numara</li>
                <li data-sorgu="17">17 - Operatör Sorgu</li>
                <li data-sorgu="18">18 - Telegram Sorgu</li>
                <li data-sorgu="32">32 - İnternet Abonelik</li>
            </ul>
        </div>

        <div class="sorgu-category">
            <div class="category-header">Araç / Plaka Sorguları</div>
            <ul class="sorgu-list">
                <li data-sorgu="24">24 - Plaka Sorgu</li>
                <li data-sorgu="28">28 - Araç Parça Sorgu</li>
            </ul>
        </div>

        <div class="sorgu-category">
            <div class="category-header">Diğer Sorgular</div>
            <ul class="sorgu-list">
                <li data-sorgu="9">9 - Ayak No Sorgu</li>
                <li data-sorgu="10">10 - Boy Sorgu</li>
                <li data-sorgu="11">11 - Burç Sorgu</li>
                <li data-sorgu="16">16 - IMEI Sorgu</li>
                <li data-sorgu="23">23 - LGS Sonuç</li>
                <li data-sorgu="25">25 - İG @by_.ram</li>
                <li data-sorgu="29">29 - Şehit Sorgu</li>
                <li data-sorgu="30">30 - Interpol Sorgu</li>
                <li data-sorgu="34">34 - Nezaket Sorgu</li>
            </ul>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>

    <h1 class="header">DARKWİB KİLLİR ECO</h1>

    <div class="main-container">
        <div class="panel">
            <div class="panel-title" id="sorgu-panel-title">Sorgu Formu</div>
            <div id="inputs"></div>
            <button id="submit">
                <span id="button-text">SORGULA</span>
                <div class="loader" id="loader"></div>
            </button>
        </div>

        <div class="panel">
            <div class="panel-title">Sorgu Sonucu</div>
            <input type="text" id="filterInput" placeholder="Sonuçları filtrele..." class="input-field mb-4">
            <div class="result" id="result"></div>
            <div class="actions">
                <button id="copy-btn">Kopyala</button>
                <button id="download-btn">İndir</button>
                <button id="clear-btn">Temizle</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <span id="notification-icon"></span>
        <span id="notification-message"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiSelect = document.getElementById('api');
            const sorguListItems = document.querySelectorAll('.sorgu-list li');
            const inputsDiv = document.getElementById('inputs');
            const submitBtn = document.getElementById('submit');
            const buttonText = document.getElementById('button-text');
            const loader = document.getElementById('loader');
            const resultDiv = document.getElementById('result');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const clearBtn = document.getElementById('clear-btn');
            const notification = document.getElementById('notification');
            const notificationIcon = document.getElementById('notification-icon');
            const notificationMessage = document.getElementById('notification-message');
            const filterInput = document.getElementById('filterInput');
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const sorguPanelTitle = document.getElementById('sorgu-panel-title');

            let lastResult = '';
            let originalResult = '';
            let selectedSorguType = '';

            const requiredInputs = {
                '1': ['tc'], '2': ['tc'], '3': ['tc'], '4': ['ad', 'soyad', 'il'], '5': ['tc'],
                '6': ['gsm'], '7': ['tc'], '8': ['tc'], '9': ['tc'], '10': ['tc'],
                '11': ['tc'], '12': ['tc'], '13': ['tc'], '14': ['tc'], '15': ['tc'],
                '16': ['imei'], '17': ['gsm'], '18': ['username'], '19': ['tc'], '20': ['tc'],
                '21': ['tc'], '22': ['tc'], '23': ['tc'], '24': ['plaka'], '25': [],
                '26': ['tc'], '27': ['tc'], '28': ['plaka'], '29': ['ad', 'soyad'], '30': ['ad', 'soyad'],
                '31': ['tc'], '32': ['tc'], '33': ['tc'], '34': ['il', 'ilce'], '35': ['tc'],
                '36': ['tc'], '37': ['tc'], '38': ['tc'], '39': ['tc'], '40': ['tc'],
                '41': ['tc']
            };

            // Menü açma/kapama işlevselliği
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('visible');
            });
            overlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                overlay.classList.remove('visible');
            });

            function updateInputs() {
                inputsDiv.innerHTML = '';
                const inputs = requiredInputs[selectedSorguType] || [];
                const sorguName = document.querySelector(`li[data-sorgu='${selectedSorguType}']`).textContent;
                
                sorguPanelTitle.textContent = sorguName;

                inputs.forEach(inputName => {
                    let labelText = '';
                    let placeholderText = '';
                    switch (inputName) {
                        case 'tc':
                            labelText = 'TC Kimlik No:';
                            placeholderText = '11 haneli TC girin';
                            break;
                        case 'ad':
                            labelText = 'Ad:';
                            placeholderText = 'İsim girin';
                            break;
                        case 'soyad':
                            labelText = 'Soyad:';
                            placeholderText = 'Soyisim girin';
                            break;
                        case 'il':
                            labelText = 'İl:';
                            placeholderText = 'Şehir girin';
                            break;
                        case 'ilce':
                            labelText = 'İlçe:';
                            placeholderText = 'İlçe girin';
                            break;
                        case 'gsm':
                            labelText = 'Telefon No:';
                            placeholderText = '5xx xxx xx xx';
                            break;
                        case 'imei':
                            labelText = 'IMEI No:';
                            placeholderText = '15 haneli IMEI girin';
                            break;
                        case 'username':
                            labelText = 'Telegram Kullanıcı Adı:';
                            placeholderText = '@kullaniciadi';
                            break;
                        case 'plaka':
                            labelText = 'Plaka:';
                            placeholderText = '34 ABC 123';
                            break;
                    }
                    addInput(inputName, labelText, placeholderText);
                });
            }

            function addInput(id, label, placeholder) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label for="${id}">${label}</label>
                    <input type="text" id="${id}" placeholder="${placeholder}" class="input-field">
                `;
                inputsDiv.appendChild(div);
                setTimeout(() => {
                    div.style.opacity = '1';
                    div.style.transform = 'translateY(0)';
                }, 100);
            }

            function showNotification(message, type = 'success') {
                notificationMessage.textContent = message;
                notification.className = `notification show ${type}`;
                notificationIcon.textContent = type === 'success' ? '✅' : '❌';

                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // Yeni formatlama fonksiyonu
            function formatResult(text) {
                if (!text) return '';

                const lines = text.split('\n').filter(line => line.trim() !== '');
                const resultCards = [];
                let currentCard = '';

                const unwantedKeywords = ['id', 'telegram', 'ip', 'user_id', 'username'];

                lines.forEach(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine.startsWith('---') && trimmedLine.endsWith('---')) {
                        if (currentCard) {
                            resultCards.push(currentCard);
                        }
                        currentCard = `<h3>${trimmedLine.replace(/---/g, '')}</h3><br>`;
                    } else if (trimmedLine.includes(':')) {
                        const [key, value] = trimmedLine.split(':').map(s => s.trim());
                        const sanitizedKey = key.toLowerCase();

                        // İstenmeyen anahtar kelimeleri kontrol et
                        const isUnwanted = unwantedKeywords.some(keyword => sanitizedKey.includes(keyword));

                        if (!isUnwanted && value) {
                            currentCard += `<p><strong>${key}:</strong> <span class="highlight">${value}</span></p>`;
                        }
                    } else if (trimmedLine) {
                        currentCard += `<p>${trimmedLine}</p>`;
                    }
                });

                if (currentCard) {
                    resultCards.push(currentCard);
                }

                return resultCards.map(cardHtml => `<div class="result-card">${cardHtml}</div>`).join('');
            }

            async function sendQuery() {
                if (!selectedSorguType) {
                    showNotification('Lütfen önce yan panelden bir sorgu seçin!', 'error');
                    return;
                }

                const api = apiSelect.value;
                const data = { api, sorgu: selectedSorguType };
                const inputs = requiredInputs[selectedSorguType] || [];

                for (const inputName of inputs) {
                    const inputElement = document.getElementById(inputName);
                    if (!inputElement || !inputElement.value.trim()) {
                        showNotification(`${inputName.toUpperCase()} alanı boş bırakılamaz!`, 'error');
                        return;
                    }
                    data[inputName] = inputElement.value.trim();
                }

                submitBtn.disabled = true;
                buttonText.style.display = 'none';
                loader.style.display = 'block';
                submitBtn.classList.remove('success', 'error');
                resultDiv.innerHTML = 'Sorgulanıyor...';
                resultDiv.style.opacity = 0.5;

                try {
                    const response = await fetch('/api/sorgu', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();

                    if (result.success) {
                        let resultText;
                        if (result.results) {
                            let combinedOutput = '';
                            for (const key in result.results) {
                                combinedOutput += `--- ${key.toUpperCase()} ---\n${result.results[key]}\n\n`;
                            }
                            resultText = combinedOutput;
                        } else {
                            resultText = result.result;
                        }
                        originalResult = resultText;
                        resultDiv.innerHTML = formatResult(resultText);
                        submitBtn.classList.add('success');
                        showNotification('Sorgu başarılı!', 'success');
                    } else {
                        lastResult = result.message || 'Sorgu başarısız oldu.';
                        originalResult = lastResult;
                        resultDiv.innerHTML = `<div class="result-card">${lastResult}</div>`;
                        submitBtn.classList.add('error');
                        showNotification(lastResult, 'error');
                    }
                } catch (error) {
                    lastResult = `Hata: ${error.message}`;
                    originalResult = lastResult;
                    resultDiv.innerHTML = `<div class="result-card">Bir hata oluştu: ${error.message}</div>`;
                    submitBtn.classList.add('error');
                    showNotification('Sorgu başarısız!', 'error');
                } finally {
                    setTimeout(() => { submitBtn.classList.remove('success', 'error'); }, 2000);
                    submitBtn.disabled = false;
                    buttonText.style.display = 'block';
                    loader.style.display = 'none';
                    filterInput.value = '';
                    resultDiv.style.opacity = 1;
                }
            }

            function filterResult() {
                const filterText = filterInput.value.toLowerCase();
                if (!filterText) {
                    resultDiv.innerHTML = formatResult(originalResult);
                    return;
                }

                const lines = originalResult.split('\n');
                const filteredLines = lines.filter(line => line.toLowerCase().includes(filterText));

                // Filtrelenmiş sonuçları formatlayıp göster
                resultDiv.innerHTML = formatResult(filteredLines.join('\n'));
            }

            copyBtn.addEventListener('click', () => {
                const textToCopy = originalResult;
                if (!textToCopy) { showNotification('Kopyalanacak sonuç yok!', 'error'); return; }
                navigator.clipboard.writeText(textToCopy)
                    .then(() => showNotification('Panoya kopyalandı!', 'success'))
                    .catch(() => showNotification('Kopyalama başarısız!', 'error'));
            });

            downloadBtn.addEventListener('click', () => {
                const textToDownload = originalResult;
                if (!textToDownload) { showNotification('İndirilecek sonuç yok!', 'error'); return; }
                const blob = new Blob([textToDownload], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const sorguAdi = document.querySelector(`li[data-sorgu='${selectedSorguType}']`).textContent;
                const fileName = `Patron_${sorguAdi}_${new Date().toISOString().slice(0, 10)}.txt`;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('Dosya indiriliyor...', 'success');
            });

            clearBtn.addEventListener('click', () => {
                resultDiv.innerHTML = '';
                lastResult = '';
                originalResult = '';
                filterInput.value = '';
                showNotification('Sonuçlar temizlendi!', 'success');
            });

            sorguListItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    document.querySelectorAll('.sorgu-list li').forEach(li => li.classList.remove('active'));
                    e.target.classList.add('active');
                    selectedSorguType = e.target.dataset.sorgu;
                    updateInputs();
                    sidebar.classList.remove('open');
                    overlay.classList.remove('visible');
                });
            });

            submitBtn.addEventListener('click', sendQuery);
            filterInput.addEventListener('input', filterResult);
            
            sorguListItems[0].click();
        });
    </script>
</body>
</html>
